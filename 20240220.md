# 2024-02-20

## Machine CAD

Still needed:

 * linear bearings on Z axis
 * gantry supports
 * ballscrews + bearings
 * ballnuts + holders
 * shaft couplers
 * motor brackets
 * screw holes

In fact, after Z bearings and gantry supports, I can
potentially do some FEA to work out where it is least
rigid and improve it.

This is the design I want to test first:

https://img.incoherency.co.uk/5317

I'm having some trouble getting Netgen to turn it into
a mesh:

https://img.incoherency.co.uk/5318

New plan: save the model as a STL, load the STL back in,
use Part workbench to create shape from mesh with "sewing"
enabled, and then use Netgen on that shape.

Great success!

https://img.incoherency.co.uk/5319

I'm not sure it's spending the triangle budget in the
wisest way, but I'll take it.

Also, I now have an opinion on what is better out of
putting the plates further apart and sinking the blocks
into the plates. I think sinking the blocks in is better,
because it reduces the size of the leverage on them,
and you don't lose as much strength as it looks like,
because there is still *material* in the area that was cut
away, it's just bolted to a lower thickness. But as long
as the bolted joint is sound, I don't think it
substantially weakens it.

One simplification in the FEA is that the entire machine
is made out of uniform "generic aluminium".

Another simplification is that we assume the linear
bearings are rigidly attached to the rails. In reality
the linear bearings are obviously free to slide, and the
forces are reacted by the ballnut and ballscrew.

I'm modelling the forces by telling it that the
table is fixed in space ("Constraint Fixed") and then
applying a force of 100N to the flat surface at the bottom
of the tool ("Constraint Force"), with the tip of the tool
in the centre of the table and 25mm up in Z.

It is taking a very long time to do the calculations,
but I attached with `strace` and it does look like it's
making progress. It would be nice if it gave some sort
of progress indicator instead of just blocking the UI
thread until done.

Hmm, I don't know what it spent a very long time on,
but it hasn't given me any results. I think I clicked the
"Solver" button in the taskbar, but when I click it now
it doesn't take a long time to compute anything, and tells
me my FEM mesh has no volume elements.

It is writing a bunch of stuff into `./test.out`. From
looking in the source, this is something to do with Netgen.

From https://incoherency.co.uk/blog/stories/freecad-fea.html it sounds like I used Gmsh instead of Netgen before,
but I can't install it right now.

I ran a FreeCAD FEM example, and it worked fine, which
suggests my problem is that the mesh has holes in it. I
wonder if I can patch it up somehow.

The Mesh workbench has a "Fill holes" option, doesn't
fix it though. I tried to "Remesh" in Blender and it
crashed Blender.

I think the core issue is that I have multiple parts with
coincident faces and nothing in the chain from "separate
Part Design parts" to "single FEA mesh" is noticing that these
need to join up.

OK, new plan: model everything again, but this time as a
single Part Design object, obviously simplify the rails
etc., and then try to do FEA on that.

https://img.incoherency.co.uk/5320

That was a lot less time than I've already wasted on
mucking about with meshes.

And Netgen generated a good mesh first time:

https://img.incoherency.co.uk/5321

The first result was that almost all of the deflection
occurs in the tool rather than the machine. However
that is probably because I told it the tool is made
out of aluminium. Since I can't easily make different
parts of the model have different materials, I'm going
to lose the tool and pretend all the force is
at the collet nut, now 45mm above the table.

With a 100N load:

* X: **0.02mm** displacement. Uprights flexing.
* Y+: **0.01mm** displacement. Gantry flexing.
* Y-: **0.01mm** displacement. Gantry flexing.
* Z+: **0.01mm** displacement. Gantry and uprights flexing.

I didn't test X+ and X- separately because the machine
is left/right symmetrical. And I didn't test Z- because
you don't generate much force in Z-.

So this was worthwhile: I have discovered that the
machine is most flexible in the X direction, which is
not what I expected.

The easy fix is to add some perpendicular bracing pieces
to the uprights. And probably to the gantry as well,
but that probably wants testing separately.

But first I want to increase the load to 1000N:

* X: **0.17mm**. Uprights.
* Y+: **0.09mm**. Gantry.
* Y-: **0.09mm**. Gantry.
* Z+: **0.08mm**. Gantry and uprights.
