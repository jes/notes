# 2025-04-15

## Consolidate

I wondered about making a "Consolidate" modifier which will turn its child object into
just a single surface. Not really sure what it would be useful for, maybe "locking" some
targeted blends so that they can't get undone by the tree rewriter?

Cool, works.

## Half-spaces

Other things that should use half-spaces to get multiple surfaces for blending include:

 * Cylinder
 * Extrude

Good, done.

And then it would be cool if Sketch's had a different surface id on each edge so that
they can have blends as well. Not sure how easy that is to do because we don't just
want `min()` of all the edges, we also need to collect up the "sign" to work out whether
the point is inside or outside. Forget it for now.

## Propagating distance fields in grids

Assume we start with an empty grid (every cell filled with "unknown" or something).
Then by some method we classify cells as "inside" or "outside".

How do we populate it with distances efficiently?

The other day I wrote:

> at each pixel/voxel you store not just the distance to the nearest point, but also the coordinates of that point, then you can propagate distances from a neighbour by checking for each of the neighbours' closest points, which one is closest to you.
> So initialise the grid only along the boundary of the surface, and then propagate the rest with a BFS?

Close, but you don't want BFS. You want one forwards pass (top-left to bottom-right) followed
by one backwards pass (bottom-right to top-left). This is apparently called Danielsson's
Euclidean distance transform.

https://perso.telecom-paristech.fr/bloch/ANIM/Danielsson.pdf

Oh, and apparently it actually has errors! It doesn't always find the true distance to
the nearest point. I can not understand how it can be wrong though, and ChatGPT is not doing
a good job of explaining it.

I got Claude to implement the "4SED" version, the code looks fine, although "DistanceDeformInside" seems broken now?

I think it is actually ImageNode that is broken. DistanceDeformInside works for things that
aren't images.

ImageNode on its own seems fine and does in fact distance-deform the sphere, albeit only
within 0.005mm of the XY plane.

But an Extruded ImageNode doesn't do distance deformation.

And in fact even an Extruded Sketch doesn't do distance deformation. So the issue is with
the new Extrude implementation based on half-spaces?
