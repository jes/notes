# 2024-02-13

## Jog control

Overnight I had some thoughts on this, related to what I committed
in https://github.com/jes/pugsender/commit/7995ffb28076a3a3f2dc39bacb8f845187605e6d

One problem is that if you are continuous jogging X and then you start
continuous jogging Y, your Y movement doesn't actually begin until
the pipeline of pending X movements has drained. And if the jog is
cancelled and restarted, the movement is not at 45 degrees because the X
axis already had built up a distant target but Y hasn't.

So instead of keeping a separate `Target` and `IncrementalTarget`, I should
instead only keep one target, the incremental target, and I should
make continuous jogging use relative movements.

The only reason to use absolute movements at all is so that I can resume
the movement properly after cancelling it (e.g. because another axis
needed its movement cancelling, and Grbl only gives you global cancel).

So I think the `JogCommand()` function would only return the un-met
incremental jog targets, and the ticker function in `jog.go` would send
relative jogs for the axes that are meant to move continuously.

Actually, having written that out, I see now why it wouldn't work. The
incremental jog movements would block the pipeline so that the continuous
jogs don't start happening until the incremental jogs are complete. Drat.

OK, new idea then: whenever a jog is cancelled, if the axis's `Target` is
a continuous target rather than an incremental one, then simply reset
`Target` to `LastPos`, that way all jogged axes will accumulate target
at the same rate, so multi-axis jogging should always be at the correct
angles.
