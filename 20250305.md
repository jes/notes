# 2025-03-05

## SDF CAD

So the plan today is to add a "document tree" to this, and then add ways to insert
primitives, modifiers, and combinators into the tree, and render the tree into GLSL
for drawing on the screen.

Primitives:

 * box
 * sphere
 * torus

Modifiers:

 * translate
 * rotate
 * scale
 * thickness
 * elongate
 * renormalise

Combinators:

 * union
 * intersection
 * difference

And see Inigo Quilez's website for more, and for shader implementations.

I'm actually having more difficulty than expected in turning my tree representation
into GLSL code.

The first attempt was to have the `generateShaderCode()` function return a single
expression, and have `shaderImplementation()` return code for supporting functions that
only wants to appear once.

So for example the Sphere `generateShaderCode()` would be `sdSphere(p, ${radius})`.
And a combinator would result in code like `opUnion(sdSphere(p, 1.0), sdSphere(p, 2.0))`
or whatever.

But then the problem is that we can't modify `p`. So we're propagating function
call code up the tree, do we need to be propagating `p` modifications *down* the tree?
But will that result in re-evaluating the modifications over and over again?

Or do we use `shaderImplementation()` to provide helper functions for every modifier?
Maybe that's the way! Just need to give them unique names. That seems to be working!

https://img.incoherency.co.uk/6005

Now with:

 * runs out of filesystem instead of requiring server
 * FPS counter (not pictured)
 * orthographic projection
 * internal tree representation of scene

Next up:

 * bring back smooth stepping for combinators
 * tree editor
 * export mesh
 * FreeCAD-like "transform" tool for positioning things in space
 * more primitives, modifiers, combinators
 * some support for custom SDF functions?
