# 2025-03-16

## Isoform

So I think the plan is to switch to using an intermediate
arithmetic tree representation in between the document tree and the GLSL. And then we
can:

 * evaluate the arithmetic tree at either a point or an interval, in JavaScript
 * generate GLSL for evaluating it at either a point or an interval
 * marching cubes with intervals will work really well because you can easily rule out an entire voxel in one evaluation

So that will want to be the "CAD kernel" for Isoform, which can be ripped out and made into
a separate "project", provisionally called "Peptide".

And this guides the kind of work I should be doing on Isoform in the immediate term:
UI improvements are totally irrelevant, I only need to be working on things that will
affect the kinds of SDFs that we need.

So I should add more node types:

Primitives:

 * more lattices
 * helix extrude
 * cone
 * ellipsoid
 * text

Modifiers:

 * bend
 * shear
 * taper
 * slice

In particular I think we *can't* have conditionals in the SDFs, because you can't do
interval arithmetic on them. You'd have to evaluate both sides and then take the min
and max.

I'm also keen to find out if there's a good way to do "tape shortening" in GLSL. We could
have each min/max node set a flag to say if it should go one way or the other, and as
long as we are continually iterating within the same interval we let the flags persist,
and if we need to evaluate a different interval we reset all the flags? Can you do
better than resetting all the flags? Remember what they were from the previous run?
You only need to stash 1 extra set of flags, because you only ever "backtrack" 1 level
(either you take the first half of the interval or the second).

And I still really want to do the thing where you can use some modifier function to
deform the domain of a LinearPattern or whatever, without deforming the actual object.

Or, for example, combine a distance deformation with a lattice, so that we only
roughen it in a gyroid pattern. So we'd be using the lattice (or any other object)
to mask the deformation.

But I can start with the primitives/modifiers above and get SDFs for them so that I have
something to work from when making Peptide.
