# 2025-02-21

## FreeCAD

I think the main things left to do are:

 * fallback synchronous code path for Windows, or if BooleanWorker can't be found etc.
 * try to expose the worker process via the main FreeCAD binary instead of adding a separate one
 * try to make the warning/error messages more suitable
 * and someone who knows the codebase better might be able to advise on how I should tidy it all up?
 * stop doing unnecessary duplicate recalculations (maybe a separate PR for this as it is useful on its own and much easier to integrate)
 * make sure everything that triggeres a Transform recompute can also trigger the Abort dialog (e.g. https://imgur.com/a/2Cua6iR )

But there is now discussion on https://github.com/FreeCAD/FreeCAD/pull/19710 about
doing it natively with OpenCascade after all, so I may be barking up the wrong tree.

I'll try to make it work via the main FreeCAD binary though.

I think we add some `--boolean-worker` option in `processProgramOptions()` in `Application.cpp`, and then it says `mConfig["RunMode"]` to `BooleanWorker` or something,
which we then implement in `runApplication()`.

Great success, works. You have to go via Python in order to access dynamically-loaded
modules, which is mildly annoying, but the plumbing isn't too bad.

"hyarion" suggests I test out the OpenCascade method of interrupting long-running
tasks.

So there is some "Message_ProgressIndicator::UserBreak()" that you can call to request
that it stop working.

So I think diff my branch from the current main branch, and then just keep the parts
that are to do with the dialog window and throw away the rest. And make the dialog
window call "Message_ProgressIndicator::UserBreak()" when you click the button.

Looks like the only file I want to keep is `src/Mod/PartDesign/Gui/ViewProviderTransformed.cpp`.

Annoyingly, `UserBreak()` is "protected" in `BRepAlgoAPI_BooleanOperation`, so I can't
call it.

Maybe cast to a custom subclass that just makes it public?

Well I got it to compile and run, but it doesn't abort. Just keeps going, as if
the `UserBreak()` doesn't do anything at all.

https://github.com/jes/FreeCAD/commit/3aa8262ff923884b8b480c86226dfcfab8a7a9b5
